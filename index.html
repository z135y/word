<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¥­ç›´å‘ä½œæ–‡æŠ„å¯«ç”¢ç”Ÿå™¨ (é›»è…¦åŒ¯å‡ºç‰ˆ)</title>
    <style>
        :root {
            /* è³‡è¨Šä¾†æºï¼šæ¥­ç•Œæ¨™æº–ç¨¿ç´™ç¶ è‰²è¦ç¯„ */
            --paper-grid-color: #2e7d32; 
            --cell-size: 50px; 
            --rows-per-col: 6; 
            --bg-color: #f4f7f6;
        }

        * { box-sizing: border-box; -webkit-print-color-adjust: exact; }

        body { 
            font-family: "æ¨™æ¥·é«”", "BiauKai", "DFKai-SB", serif; 
            padding: 20px; 
            background: var(--bg-color); 
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ä»‹é¢æ“ä½œé¢æ¿ */
        .ui-panel { 
            background: white; 
            padding: 25px; 
            border-radius: 12px; 
            margin-bottom: 30px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            width: 100%;
            max-width: 900px;
        }

        .ui-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--paper-grid-color);
            margin-bottom: 10px;
            border-left: 5px solid var(--paper-grid-color);
            padding-left: 10px;
        }

        /* é›»è…¦ç«¯ä¸‹è¼‰/åŒ¯å‡ºå¼•å° */
        .instruction-box {
            background: #e7f3ff;
            border: 1px solid #b8daff;
            padding: 15px;
            font-size: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            color: #004085;
            line-height: 1.6;
        }

        textarea { 
            width: 100%; 
            height: 180px;
            padding: 15px; 
            border: 1.5px solid #ccc; 
            border-radius: 6px; 
            font-size: 20px;
            writing-mode: vertical-rl; 
            text-orientation: upright;
            background: #fffdf9;
            outline: none;
            line-height: 1.8;
        }

        .config-bar {
            margin-top: 15px;
            display: flex;
            gap: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 14px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn-group {
            margin-top: 20px;
            display: flex;
            gap: 12px;
        }

        button { 
            padding: 12px 28px; 
            cursor: pointer; 
            border: none; 
            border-radius: 6px; 
            font-weight: bold; 
            font-size: 16px;
            background: var(--paper-grid-color);
            color: white;
            transition: 0.2s;
        }
        
        button:hover { opacity: 0.9; }
        .btn-download { background: #004085; }

        /* ç¨¿ç´™æ¸²æŸ“å€åŸŸ */
        #main-container {
            display: flex;
            flex-direction: column;
            gap: 40px;
            width: 100%;
            align-items: center;
        }

        .page-block {
            background: white;
            padding: 50px;
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            align-items: flex-end; 
            page-break-after: always;
            border: 1px solid #ddd;
        }

        .area-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            border-right: 4px solid var(--paper-grid-color);
            padding-right: 12px;
            text-align: right;
            width: 100%;
            font-weight: bold;
        }

        .manuscript-grid {
            display: grid;
            writing-mode: vertical-rl; 
            text-orientation: upright;
            grid-template-columns: repeat(var(--rows-per-col), var(--cell-size));
            grid-auto-rows: var(--cell-size);
            grid-auto-flow: row; 
            border-top: 2.5px solid var(--paper-grid-color);
            border-right: 2.5px solid var(--paper-grid-color);
            background: white;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            border-bottom: 1px solid var(--paper-grid-color);
            border-left: 1px solid var(--paper-grid-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: calc(var(--cell-size) * 0.7);
            position: relative;
        }

        .cell::after {
            content: "";
            position: absolute;
            width: 100%; height: 100%;
            background-image: 
                linear-gradient(to right, rgba(46, 125, 50, 0.1) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(46, 125, 50, 0.1) 1px, transparent 1px);
            background-position: center;
            background-size: 100% 100%;
            pointer-events: none;
        }

        .divider { height: 60px; width: 100%; position: relative; }
        .divider::after { content: ""; position: absolute; top: 50%; left: 0; width: 100%; border-top: 1px dashed #ccc; }

        /* æ¥­ç•Œæ¨™æº–ï¼šA4 åˆ—å°æ¨£å¼è¨­å®š */
        @page {
            size: A4 portrait;
            margin: 15mm;
        }

        @media print {
            body { background: white; padding: 0; }
            .ui-panel { display: none; }
            #main-container { gap: 0; width: 100%; }
            .page-block { 
                box-shadow: none; 
                border: none; 
                margin: 0; 
                padding: 10mm; 
                width: 190mm; /* A4 åˆ—å°å®‰å…¨å¯¬åº¦ */
            }
        }
    </style>
</head>
<body>

<div class="ui-panel">
    <div class="ui-title">å°ˆæ¥­ç›´å‘ä½œæ–‡æŠ„å¯«ç”¢ç”Ÿå™¨</div>
    
    <!-- é›»è…¦ç«¯å°ˆå±¬å¼•å°è³‡è¨Š -->
    <div class="instruction-box">
        <b>ğŸ’» é›»è…¦åŒ¯å‡ºæ•™å­¸ï¼š</b><br>
        1. åœ¨è¼¸å…¥æ¡†å¡«å¯«æ–‡å­—ã€‚<br>
        2. é»æ“Šä¸‹æ–¹ <b>ã€ŒåŒ¯å‡ºæˆå“ç‚º PDFã€</b>ã€‚<br>
        3. è¦–çª—è·³å‡ºå¾Œï¼Œåœ¨å³å´ã€Œç›®çš„åœ°ã€é¸å–®é¸æ“‡ <b>ã€Œå¦å­˜ç‚º PDF (Save as PDF)ã€</b> ä¸¦å„²å­˜ã€‚
    </div>
    
    <textarea id="textInput" oninput="sync()" placeholder="åœ¨æ­¤è¼¸å…¥æ–‡å­—...">æ–‡å­—ç”±ä¸Šè€Œä¸‹
ç”±å³å‘å·¦æ›åˆ—
æŠ„å¯«ç·´ç¿’å·¥å…·</textarea>
    
    <div class="config-bar">
        <div>æ¯åˆ—å­—æ•¸ (å‚ç›´)ï¼š<input type="number" id="rowSelect" value="6" min="1" max="30" oninput="sync()" style="width:60px; padding:5px;"></div>
        <div>æ ¼å­å¤§å°ï¼š<input type="range" id="sizeRange" min="30" max="100" value="50" oninput="sync()"></div>
    </div>
    
    <div class="btn-group">
        <button onclick="sync()">ğŸ”„ æ›´æ–°é è¦½</button>
        <button class="btn-download" onclick="window.print()">ğŸ“¥ åŒ¯å‡ºæˆå“ç‚º PDF</button>
    </div>
</div>

<div id="main-container"></div>

<script>
    function sync() {
        const rawText = document.getElementById('textInput').value;
        const rowsPerCol = parseInt(document.getElementById('rowSelect').value) || 6;
        const cellSize = parseInt(document.getElementById('sizeRange').value) || 50;
        const container = document.getElementById('main-container');

        document.documentElement.style.setProperty('--rows-per-col', rowsPerCol);
        document.documentElement.style.setProperty('--cell-size', cellSize + 'px');

        let processedText = "";
        rawText.split('\n').forEach(line => {
            const clean = line.trim();
            if (clean.length > 0) {
                processedText += clean;
                const rem = clean.length % rowsPerCol;
                if (rem !== 0) processedText += " ".repeat(rowsPerCol - rem);
            } else {
                processedText += " ".repeat(rowsPerCol);
            }
        });

        container.innerHTML = '';
        const limit = rowsPerCol * 15; 

        if (processedText.length === 0) {
            renderPage("", 1, rowsPerCol, limit);
            return;
        }

        for (let i = 0; i < processedText.length; i += limit) {
            const chunk = processedText.substring(i, i + limit);
            renderPage(chunk, Math.floor(i / limit) + 1, rowsPerCol, limit);
        }

        function renderPage(content, num, rows, total) {
            const block = document.createElement('div');
            block.className = 'page-block';
            block.appendChild(createSection(`ç¤ºç¯„å€ (ç¬¬ ${num} é )`, content, true, rows, total));
            const div = document.createElement('div'); div.className = 'divider';
            block.appendChild(div);
            block.appendChild(createSection(`ç·´ç¿’æŠ„å¯«å€`, "", false, rows, total));
            container.appendChild(block);
        }

        function createSection(label, text, isDemo, rows, total) {
            const wrap = document.createElement('div');
            wrap.style.cssText = "display:flex;flex-direction:column;align-items:flex-end;width:100%;";
            const lbl = document.createElement('div');
            lbl.className = 'area-label'; lbl.innerText = label;
            wrap.appendChild(lbl);
            const grid = document.createElement('div');
            grid.className = 'manuscript-grid';
            for (let j = 0; j < total; j++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                const c = text[j];
                cell.innerText = isDemo && c && c !== ' ' ? c : '';
                grid.appendChild(cell);
            }
            wrap.appendChild(grid);
            return wrap;
        }
    }
    window.onload = sync;
</script>

</body>
</html>
